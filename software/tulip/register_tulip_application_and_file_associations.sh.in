# Installation folder prefix for desktop and mime files
installationPrefix=~/.local

# Create directories if missing
mkdir -p $installationPrefix/share/mime/packages
mkdir -p $installationPrefix/share/applications
mkdir -p $installationPrefix/share/pixmaps
mkdir -p $installationPrefix/share/icons

# Create mime xml for each Tulip file extension
echo "<?xml version=\"1.0\" encoding=\"UTF-8\"?>
<mime-info xmlns=\"http://www.freedesktop.org/standards/shared-mime-info\">
    <mime-type type=\"application/x-tulip-tlpx\">
        <comment>Tulip project file</comment>
        <icon name=\"application-x-tulip\"/>
        <glob pattern=\"*.tlpx\"/>
    </mime-type>
</mime-info>" > $installationPrefix/share/mime/packages/application-x-tulip-tlpx.xml

echo "<?xml version=\"1.0\" encoding=\"UTF-8\"?>
<mime-info xmlns=\"http://www.freedesktop.org/standards/shared-mime-info\">
    <mime-type type=\"application/x-tulip-tlp\">
        <comment>Tulip graph file (TLP format)</comment>
        <icon name=\"application-x-tulip\"/>
        <glob pattern=\"*.tlp\"/>
    </mime-type>
</mime-info>" > $installationPrefix/share/mime/packages/application-x-tulip-tlp.xml

echo "<?xml version=\"1.0\" encoding=\"UTF-8\"?>
<mime-info xmlns=\"http://www.freedesktop.org/standards/shared-mime-info\">
    <mime-type type=\"application/x-tulip-tlpgz\">
        <comment>Tulip graph file (gzipped TLP format)</comment>
        <icon name=\"application-x-tulip\"/>
        <glob pattern=\"*.tlp.gz\"/>
    </mime-type>
</mime-info>" > $installationPrefix/share/mime/packages/application-x-tulip-tlpgz.xml

echo "<?xml version=\"1.0\" encoding=\"UTF-8\"?>
<mime-info xmlns=\"http://www.freedesktop.org/standards/shared-mime-info\">
    <mime-type type=\"application/x-tulip-tlpz\">
        <comment>Tulip graph file (gzipped TLP format)</comment>
        <icon name=\"application-x-tulip\"/>
        <glob pattern=\"*.tlpz\"/>
    </mime-type>
</mime-info>" > $installationPrefix/share/mime/packages/application-x-tulip-tlpz.xml

echo "<?xml version=\"1.0\" encoding=\"UTF-8\"?>
<mime-info xmlns=\"http://www.freedesktop.org/standards/shared-mime-info\">
    <mime-type type=\"application/x-tulip-tlpb\">
        <comment>Tulip graph file (TLPB format)</comment>
        <icon name=\"application-x-tulip\"/>
        <glob pattern=\"*.tlpb\"/>
    </mime-type>
</mime-info>" > $installationPrefix/share/mime/packages/application-x-tulip-tlpb.xml

echo "<?xml version=\"1.0\" encoding=\"UTF-8\"?>
<mime-info xmlns=\"http://www.freedesktop.org/standards/shared-mime-info\">
    <mime-type type=\"application/x-tulip-tlpbgz\">
        <comment>Tulip graph file (gzipped TLPB format)</comment>
        <icon name=\"application-x-tulip\"/>
        <glob pattern=\"*.tlpb.gz\"/>
    </mime-type>
</mime-info>" > $installationPrefix/share/mime/packages/application-x-tulip-tlpbgz.xml

echo "<?xml version=\"1.0\" encoding=\"UTF-8\"?>
<mime-info xmlns=\"http://www.freedesktop.org/standards/shared-mime-info\">
    <mime-type type=\"application/x-tulip-tlpbz\">
        <comment>Tulip graph file (gzipped TLPB format)</comment>
        <icon name=\"application-x-tulip\"/>
        <glob pattern=\"*.tlpbz\"/>
    </mime-type>
</mime-info>" > $installationPrefix/share/mime/packages/application-x-tulip-tlpbz.xml

# Create Tulip application desktop file
echo "[Desktop Entry]
Name=Tulip @TulipVersion@
Exec=@CMAKE_INSTALL_PREFIX@/bin/tulip --no-show-agent %U
MimeType=application/x-tulip-tlpx;application/x-tulip-tlp;application/x-tulip-tlpgz;application/x-tulip-tlpz;application/x-tulip-tlpb;application/x-tulip-tlpbgz;application/x-tulip-tlpbz
Icon=tulip
Terminal=false
Type=Application
Categories=Science
Comment=Large graphs analysis and visualization
"> $installationPrefix/share/applications/Tulip-@TulipVersion@.desktop

# update databases for both application and mime
update-desktop-database $installationPrefix/share/applications
update-mime-database    $installationPrefix/share/mime

# copy associated icons to pixmaps and icons
cp @CMAKE_CURRENT_SOURCE_DIR@/resources/icons/tulip-icon.png $installationPrefix/share/pixmaps/tulip.png
cp @CMAKE_CURRENT_SOURCE_DIR@/resources/icons/tulip-file-icon.png $installationPrefix/share/pixmaps/application-x-tulip.png
cp @CMAKE_CURRENT_SOURCE_DIR@/resources/icons/tulip-icon.png $installationPrefix/share/icons/tulip.png
cp @CMAKE_CURRENT_SOURCE_DIR@/resources/icons/tulip-file-icon.png $installationPrefix/share/icons/application-x-tulip.png
